## BlueNotebook V3.2.1 - "Notes" Panel Feature Summary

This document outlines the features implemented for the new "Notes" panel, a dedicated file and note manager integrated directly within BlueNotebook.

### 1. Core Panel Functionality

- **Dedicated Panel**: A new, persistent panel located on the far left of the main window.
- **Toggle Visibility**: The panel can be shown or hidden using a dedicated "Notes" switch button in the top toolbar, or via the `F9` shortcut. Its visibility state is saved and restored between sessions.
- **UI Design**:
    - Features a clean, tab-style header labeled "Notes".
    - The initial width is set to 400px but is fully resizable.
    - The file tree view is zoomable using `Ctrl + Mouse Wheel` for better accessibility.

### 2. File and Folder Tree View

- **Directory Browsing**: Displays a `QTreeView` of the `notes/` subdirectory within the current journal. It shows all subdirectories and files.
- **File Filtering**: The view is filtered to only display supported file types, including:
    - **Text**: `.md`, `.txt`
    - **Documents**: `.pdf`, `.epub`, `.html`
    - **Media**: `.jpg`, `.png`, `.gif`, `.mp4`, `.avi`, `.mkv`, `.mp3`, `.flac`
- **State Persistence**: The last selected folder is saved in the user's settings and is automatically re-selected and highlighted when the application starts.
- **Folder Coloring**: Users can assign one of 10 predefined background colors to any folder for better visual organization. This color choice is saved and restored across sessions.

### 3. Context Menu & File Operations

A rich context menu is available via a right-click, with options changing based on the context (file, folder, or empty area).

#### When right-clicking on a **Folder**:

- **`New Note...`**: Opens a dialog to create a new `.md` file. The user can provide a name and optionally choose a template. The new note is then opened in the editor.
- **`Create Subfolder...`**: Prompts for a name and creates a new directory inside the selected folder.
- **`Import File...`**: Opens a dialog to import a file either from a local path or a remote URL. The file is copied/downloaded into the selected folder. The import is validated against the list of supported file types.
- **`Expand All` / `Collapse All`**: Recursively expands or collapses all subdirectories within the selected folder.
- **`Folder Color`**: A submenu to assign or remove a background color for the folder.
- **`Copy` / `Cut`**: Copies or marks the folder for a move operation.
- **`Paste`**: Pastes a previously copied/cut file or folder into the selected directory.
- **`Rename...`**: Allows renaming the folder.
- **`Delete...`**: Deletes the folder. A confirmation dialog appears, which intelligently warns the user if the folder is empty or if it contains files and subfolders (providing a recursive count of all items that will be deleted).

#### When right-clicking on a **File**:

- **`Open`**: Opens the file in the appropriate viewer:
    - `.md`, `.txt`: Opens in the main Markdown editor.
    - `.pdf`, `.epub`: Opens in the integrated Document Reader panel.
    - Images, Videos, Audio: Opens in the system's default external application.
- **`Copy` / `Cut`**: Copies or marks the file for a move operation.
- **`Rename...`**: Allows renaming the file.
- **`Delete...`**: Deletes the file after a confirmation prompt.

#### When right-clicking on an **empty area** in the tree view:

- **`Create Folder...`**: Prompts for a name and creates a new folder at the root of the `notes/` directory.
- **`Paste`**: Pastes a previously copied/cut file or folder into the root of the `notes/` directory.

### 4. Behind the Scenes: Implementation Details

- **File System Model**: Uses a custom `QFileSystemModel` subclass to handle folder coloring.
- **Clipboard Operations**: Implemented internally within the `NotesPanel` to manage the source path and the operation type (`copy` or `cut`).
- **File Handling**: Uses Python's `shutil` module for robust file operations (`copy2`, `copytree`, `move`, `rmtree`).
- **Remote File Import**: Uses the `requests` library to download files from URLs.

This comprehensive feature set transforms the "Notes" panel into a powerful, integrated file manager, making BlueNotebook a more versatile tool for organizing not just daily journal entries, but also a wide range of associated documents and media.
