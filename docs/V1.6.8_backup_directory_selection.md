# Spécification : Mécanisme de Sélection du Répertoire de Sauvegarde

Cette documentation décrit plusieurs approches pour implémenter une fonctionnalité permettant à l'utilisateur de définir un répertoire de sauvegarde par défaut pour les archives du journal.

Actuellement, l'application ouvre une boîte de dialogue qui permet de choisir où enregistrer chaque sauvegarde, mais il n'y a pas de moyen de définir un répertoire de sauvegarde *par défaut*.

---

## Approche 1 : Mémoriser le dernier répertoire utilisé (Simple et efficace)

C'est la solution la plus simple et souvent la plus appréciée des utilisateurs. L'application se souvient simplement du dernier dossier où une sauvegarde a été effectuée et l'ouvre par défaut la fois suivante.

**Comment ça marche :**
1.  Lorsque l'utilisateur effectue une sauvegarde via `Fichier > Sauvegarde Journal...`, l'application utilise `QFileDialog.getSaveFileName`.
2.  Une fois que l'utilisateur a choisi un emplacement et que la sauvegarde est réussie, le chemin du *dossier* parent de ce fichier est enregistré dans les paramètres de l'application (`settings.json`).
3.  La prochaine fois que l'utilisateur cliquera sur "Sauvegarde Journal...", l'application lira ce chemin depuis les paramètres et le passera comme répertoire de départ à `QFileDialog.getSaveFileName`.

**Avantages :**
*   Très simple à implémenter.
*   Intuitif pour l'utilisateur, qui retrouve naturellement son dernier emplacement.

**Inconvénients :**
*   Moins de contrôle si l'utilisateur veut un dossier de sauvegarde fixe, différent de son dernier choix ponctuel.

---

## Approche 2 : Ajouter une option dans les Préférences (Contrôle total pour l'utilisateur)

Cette approche est plus formelle et donne à l'utilisateur un contrôle explicite sur le répertoire de sauvegarde par défaut.

**Comment ça marche :**
1.  **Modifier la fenêtre des Préférences** (`preferences_dialog.py`) :
    *   Ajouter un nouvel onglet "Sauvegarde" ou une section dans l'onglet "Général".
    *   Dans cette section, ajouter :
        *   Un `QLineEdit` pour afficher le chemin du répertoire de sauvegarde.
        *   Un bouton "Parcourir..." qui ouvrira un `QFileDialog.getExistingDirectory` pour permettre à l'utilisateur de choisir un dossier.
        *   Une case à cocher "Toujours demander où sauvegarder" pour permettre de désactiver ce comportement et revenir au fonctionnement actuel.

2.  **Sauvegarder le paramètre** :
    *   Lorsque l'utilisateur valide les préférences, enregistrer le chemin du dossier choisi dans `settings.json` (par exemple, sous la clé `backup.default_directory`).

3.  **Utiliser le paramètre** :
    *   Dans la fonction qui gère la sauvegarde (`backup_journal` dans `main_window.py`), lire ce paramètre.
    *   Si un répertoire par défaut est défini (et que la case "Toujours demander" n'est pas cochée), construire le nom du fichier de sauvegarde et l'enregistrer directement dans ce répertoire.
    *   Sinon, ouvrir le `QFileDialog` comme actuellement, en utilisant le répertoire par défaut comme point de départ.

**Avantages :**
*   L'utilisateur a un contrôle total et permanent.
*   Le comportement est explicite et configurable.

**Inconvénients :**
*   Demande plus de modifications dans l'interface utilisateur.

---

## Approche 3 : Utiliser une variable d'environnement (Pour les utilisateurs avancés)

Cette méthode est invisible pour l'utilisateur lambda mais très pratique pour les développeurs ou les "power users" qui aiment configurer leur environnement via des scripts.

**Comment ça marche :**
1.  Dans la logique de sauvegarde, avant d'ouvrir la boîte de dialogue, vérifier si une variable d'environnement (par exemple, `BACKUP__DIRECTORY`) est définie.
    ```python
    import os
    
    backup_dir = os.getenv("BACKUP__DIRECTORY")
    if backup_dir and os.path.isdir(backup_dir):
        # Utiliser ce répertoire comme point de départ ou pour une sauvegarde directe
    else:
        # Comportement normal
    ```
2.  L'utilisateur peut alors configurer cette variable dans son système ou dans le script de lancement `run_bluenotebook.sh`.

**Avantages :**
*   Aucun changement d'interface nécessaire.
*   Idéal pour l'automatisation et la configuration par script.

**Inconvénients :**
*   Non découvrable par les utilisateurs non techniques.