# Sp√©cification Technique : Panneau de Navigation

## 1. Vue d'ensemble fonctionnelle

Le panneau de navigation est un composant cl√© de l'interface de BlueNotebook, situ√© √† gauche de l'√©diteur. Son objectif principal est de fournir √† l'utilisateur des outils visuels et interactifs pour explorer ses notes de journal de mani√®re temporelle.

Il est compos√© de deux √©l√©ments principaux :
1.  **Un Calendrier Interactif (`QCalendarWidget`)** : Affiche une vue mensuelle et met en √©vidence les jours pour lesquels une note existe.
2.  **Des Boutons de Navigation (`QToolBar`)** : Permettent de se d√©placer s√©quentiellement entre les notes existantes et de revenir rapidement √† la date du jour.

Le panneau peut √™tre affich√© ou masqu√© via le menu `Affichage -> Basculer Navigation` ou le raccourci `F6`.

## 2. Architecture Technique et Composants

La fonctionnalit√© de navigation est principalement impl√©ment√©e dans la classe `MainWindow` (`gui/main_window.py`), qui orchestre les interactions entre le panneau de navigation, l'√©diteur de texte et le syst√®me de gestion de fichiers.

### 2.1. Composants PyQt5 utilis√©s

-   **`QDockWidget`** : Le panneau de navigation est un `QDockWidget` pour lui permettre d'√™tre "dock√©" √† gauche, redimensionn√©, et masqu√©/affich√© facilement.
    ```python
    # Dans MainWindow.setup_ui()
    self.navigation_dock = QDockWidget(self.tr("üß≠ Navigation"), self)
    self.addDockWidget(Qt.LeftDockWidgetArea, self.navigation_dock)
    ```

-   **`QCalendarWidget`** : Le c≈ìur visuel de la navigation.
    ```python
    # Dans une m√©thode de cr√©ation du panneau de navigation
    self.calendar = QCalendarWidget()
    self.calendar.setGridVisible(True)
    ```

-   **`QToolBar`** et **`QAction`** : Utilis√©s pour cr√©er la barre d'outils contenant les boutons "Jour Pr√©c√©dent", "Aujourd'hui", et "Jour Suivant".
    ```python
    # Dans une m√©thode de cr√©ation du panneau de navigation
    nav_toolbar = QToolBar()
    self.prev_day_action = QAction(QIcon.fromTheme("go-previous"), self.tr("Jour pr√©c√©dent"), self)
    self.today_action = QAction(QIcon.fromTheme("go-home"), self.tr("Aujourd'hui"), self)
    self.next_day_action = QAction(QIcon.fromTheme("go-next"), self.tr("Jour suivant"), self)
    nav_toolbar.addAction(self.prev_day_action)
    # ... etc.
    ```

### 2.2. Logique de synchronisation (Signaux et Slots)

La synchronisation entre le calendrier, les boutons et l'√©diteur est g√©r√©e par le syst√®me de signaux et slots de PyQt5.

-   **Clic sur une date du calendrier** : Le signal `clicked(QDate)` du `QCalendarWidget` est connect√© √† un slot dans `MainWindow`.
    ```python
    # Connexion du signal
    self.calendar.clicked.connect(self.on_calendar_date_selected)

    # Slot de traitement
    def on_calendar_date_selected(self, date):
        # 1. Convertit la QDate en nom de fichier (ex: "20241026.md")
        # 2. Construit le chemin complet du fichier dans le r√©pertoire du journal.
        # 3. Appelle la m√©thode `self.open_file(filepath)` pour charger la note.
        # 4. Si le fichier n'existe pas, affiche un message dans la barre de statut.
    ```

-   **Chargement d'un fichier dans l'√©diteur** : Chaque fois qu'un fichier est ouvert (que ce soit au d√©marrage, via `Fichier > Ouvrir` ou via le calendrier), une m√©thode de mise √† jour est appel√©e pour synchroniser le calendrier.
    ```python
    # Dans la m√©thode open_file(filepath)
    def open_file(self, filepath):
        # ... (logique d'ouverture de fichier) ...
        self.update_calendar_for_file(filepath)

    def update_calendar_for_file(self, filepath):
        # 1. Extrait la date du nom de fichier (ex: "20241026.md" -> QDate(2024, 10, 26)).
        # 2. Si la date est valide, appelle `self.calendar.setSelectedDate(date)`.
    ```

-   **Clic sur les boutons de navigation** : Chaque `QAction` (`prev_day_action`, `next_day_action`) est connect√© √† un slot.
    ```python
    # Connexion des signaux
    self.prev_day_action.triggered.connect(self.find_previous_note)
    self.next_day_action.triggered.connect(self.find_next_note)

    # Slot de traitement (exemple pour "Jour Pr√©c√©dent")
    def find_previous_note(self):
        # 1. R√©cup√®re la date actuelle de l'√©diteur.
        # 2. Scanne le r√©pertoire du journal √† la recherche de tous les fichiers .md.
        # 3. Trie les fichiers par ordre ant√©chronologique.
        # 4. Trouve le premier fichier dont la date est ant√©rieure √† la date actuelle.
        # 5. Si un fichier est trouv√©, l'ouvre avec `self.open_file(found_filepath)`.
    ```

## 3. Mise en √©vidence des jours avec notes

Pour que l'utilisateur puisse identifier visuellement les jours contenant une note, une mise en forme sp√©ciale est appliqu√©e au calendrier.

-   **D√©clenchement** : Ce processus est d√©clench√© au d√©marrage de l'application et chaque fois que le r√©pertoire du journal est modifi√© (`Fichier -> Ouvrir Journal`).
-   **Processus** :
    1.  Une m√©thode `scan_journal_for_notes()` parcourt tous les fichiers `.md` du r√©pertoire du journal.
    2.  Pour chaque fichier, elle extrait la date de son nom.
    3.  Ces dates sont stock√©es dans un `set` pour un acc√®s rapide : `self.notes_with_dates`.
    4.  Un `QTextCharFormat` est cr√©√© pour d√©finir le style (par exemple, couleur bleue, texte en gras).
        ```python
        self.note_format = QTextCharFormat()
        self.note_format.setForeground(QColor("#3498db"))
        self.note_format.setFontWeight(QFont.Bold)
        ```
    5.  La m√©thode parcourt les dates dans `self.notes_with_dates` et applique le format √† chaque date correspondante dans le calendrier.
        ```python
        for date in self.notes_with_dates:
            self.calendar.setDateTextFormat(date, self.note_format)
        ```
-   **Mise √† jour** : Le calendrier est rafra√Æchi en appelant cette logique de scan et de formatage √† chaque changement de r√©pertoire de journal.

## 4. Diagramme de s√©quence (Interaction utilisateur)

Voici un diagramme illustrant le flux d'√©v√©nements lorsqu'un utilisateur clique sur une date dans le calendrier.

```mermaid
sequenceDiagram
    participant User
    participant NavigationPanel
    participant MainWindow
    participant Editor

    User->>NavigationPanel: Clique sur une date (ex: 2024-10-25)
    NavigationPanel-->>MainWindow: √âmet le signal clicked(QDate(2024, 10, 25))
    MainWindow->>MainWindow: on_calendar_date_selected(date)
    MainWindow->>MainWindow: Construit le chemin du fichier "20241025.md"
    MainWindow->>MainWindow: Appelle open_file(".../20241025.md")
    MainWindow->>Editor: setPlainText(contenu du fichier)
    MainWindow->>MainWindow: update_statusbar(nom du fichier)
    Note right of MainWindow: Le calendrier est d√©j√† √† la bonne date, pas de mise √† jour n√©cessaire.
```
 

<!--
[PROMPT_SUGGESTION]Maintenant, mets √† jour le fichier de documentation technique principal pour inclure une section sur la navigation en se basant sur ce nouveau fichier.[/PROMPT_SUGGESTION]
[PROMPT_SUGGESTION]Peux-tu g√©n√©rer le code Python pour impl√©menter la logique d√©crite dans `V1.2.2_navigation.md` dans le fichier `main_window.py` ?[/PROMPT_SUGGESTION]
 
