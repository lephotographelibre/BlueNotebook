## **Chapitre Y : Installation, Configuration et Lancement (Windows)**

Ce chapitre décrit la procédure pour installer, configurer et lancer l'application BlueNotebook sur un système d'exploitation Windows.

### **Y.1. Prérequis**

L'application s'appuie sur `pyenv-win` pour une gestion propre et isolée de la version de Python.

*   **pyenv-win** : Un outil essentiel pour gérer plusieurs versions de Python sous Windows. Si vous ne l'avez pas, veuillez l'installer en suivant les instructions sur le [dépôt officiel pyenv-win](https://github.com/pyenv-win/pyenv-win#installation).

### **Y.2. Installation des Dépendances**

Le projet inclut un script batch (`.bat`) qui automatise l'ensemble du processus d'installation.

1.  **Clonez ou téléchargez le projet** sur votre machine (par exemple, dans `C:\Users\VotreNom\Documents\BlueNotebook`).
2.  Ouvrez l'explorateur de fichiers, naviguez jusqu'au répertoire `bluenotebook/`.
3.  Double-cliquez sur le fichier `run_bluenotebook.bat`.

Une fenêtre de terminal (Command Prompt) s'ouvrira. Lors de sa toute première exécution, le script réalisera les étapes suivantes :
*   Il vérifiera la présence de `pyenv-win`.
*   Il installera la version de Python requise (ex: `3.13.5`) si elle n'est pas déjà installée.
*   Il créera un environnement virtuel dédié (nommé `.venv_bluenotebook`).
*   Il installera toutes les dépendances nécessaires depuis `requirements.txt` dans cet environnement.

Ce processus peut prendre quelques minutes la première fois. Les lancements suivants seront quasi-instantanés.

### **Y.3. Lancement de l'Application**

Pour lancer BlueNotebook, double-cliquez simplement sur `run_bluenotebook.bat`.

Pour spécifier un répertoire de journal différent au démarrage, vous pouvez lancer le script depuis un terminal (`cmd` ou `PowerShell`) en ajoutant l'argument `--journal` :
```cmd
C:\path\to\bluenotebook> run_bluenotebook.bat --journal C:\Users\VotreNom\Documents\MonJournalDeVoyage
```

### **Y.4. Intégration au Bureau Windows (Raccourci)**

Pour un accès plus facile, vous pouvez créer un raccourci sur votre Bureau.

1.  Dans l'explorateur de fichiers, faites un clic droit sur le fichier `run_bluenotebook.bat`.
2.  Sélectionnez `Envoyer vers` > `Bureau (créer un raccourci)`.
3.  Allez sur votre Bureau, faites un clic droit sur le nouveau raccourci et choisissez `Propriétés`.
4.  Dans l'onglet `Raccourci`, cliquez sur le bouton `Changer d'icône...`.
5.  Cliquez sur `Parcourir...` et naviguez jusqu'au dossier `resources\icons` de BlueNotebook.
6.  Sélectionnez le fichier `bluenotebook.ico` et validez toutes les fenêtres.

Votre raccourci a maintenant l'icône officielle de l'application.

### **Y.5. Configuration Avancée via les Variables d'Environnement**

Vous pouvez configurer BlueNotebook en définissant des variables d'environnement. C'est utile pour définir des chemins de manière permanente sans avoir à les taper à chaque fois.

Pour définir une variable d'environnement de manière permanente sous Windows :
1.  Ouvrez le menu Démarrer et tapez `variables d'environnement`.
2.  Cliquez sur `Modifier les variables d'environnement système`.
3.  Dans la fenêtre qui s'ouvre, cliquez sur le bouton `Variables d'environnement...`.
4.  Dans la section "Variables utilisateur", cliquez sur `Nouvelle...` pour en créer une.

Voici les variables que vous pouvez utiliser :

#### **Définir le Répertoire du Journal (JOURNAL_DIRECTORY)**
Indique à BlueNotebook où trouver vos notes.
*   **Nom de la variable :** `JOURNAL_DIRECTORY`
*   **Valeur de la variable :** `C:\Users\VotreNom\Dropbox\MonJournal`

#### **Forcer la Langue de l'Application (BLUENOTEBOOK_LOCALE)**
Force la langue pour les dialogues système de l'application (ex: Ouvrir, Enregistrer).
*   **Nom de la variable :** `BLUENOTEBOOK_LOCALE`
*   **Valeur de la variable :** `en_US` (pour l'anglais), `fr_FR` (pour le français), etc.

#### **Définir le Répertoire de Sauvegarde (BACKUP_DIRECTORY)**
Définit le dossier par défaut pour les sauvegardes du journal.
*   **Nom de la variable :** `BACKUP_DIRECTORY`
*   **Valeur de la variable :** `D:\Sauvegardes\BlueNotebook`

## run_bluenotebook.bat réécrit par Gemini CLI

```bat
@echo off
REM Script de lancement pour BlueNotebook sur Windows
REM Version 2.0 - Ajout de la gestion des variables d'environnement par défaut

setlocal

set "PYTHON_VERSION=3.13.5"
set "VENV_NAME=.venv_bluenotebook"

echo "--- Lancement de BlueNotebook ---"

REM --- Configuration de l'environnement (valeurs par défaut si non définies) ---

REM Répertoire du journal par défaut
if not defined JOURNAL_DIRECTORY (
    set "JOURNAL_DIRECTORY=%USERPROFILE%\BlueNotebookJournal"
)
echo "Répertoire du journal utilisé : %JOURNAL_DIRECTORY%"

REM Locale par défaut
if not defined BLUENOTEBOOK_LOCALE (
    set "BLUENOTEBOOK_LOCALE=fr_FR"
)
echo "Locale utilisée : %BLUENOTEBOOK_LOCALE%"

REM Répertoire de sauvegarde par défaut
if not defined BACKUP_DIRECTORY (
    set "BACKUP_DIRECTORY=%USERPROFILE%\Documents\BlueNotebook_Backups"
)
echo "Répertoire de sauvegarde par défaut : %BACKUP_DIRECTORY%"


REM --- Vérification de l'environnement ---

REM 1. Vérifier si pyenv-win est installé
if not exist "%USERPROFILE%\.pyenv\pyenv-win\bin\pyenv.bat" (
    echo "ERREUR: pyenv-win n'est pas détecté."
    echo "Veuillez l'installer pour gérer les versions de Python : https://github.com/pyenv-win/pyenv-win#installation"
    pause
    exit /b 1
)

REM Ajouter pyenv au PATH pour cette session
set "PATH=%USERPROFILE%\.pyenv\pyenv-win\bin;%USERPROFILE%\.pyenv\pyenv-win\shims;%PATH%"

REM 2. Vérifier si la version de Python est installée
pyenv versions | findstr /C:"%PYTHON_VERSION%" > nul
if %errorlevel% neq 0 (
    echo "Python %PYTHON_VERSION% n'est pas installé via pyenv."
    echo "Tentative d'installation..."
    pyenv install %PYTHON_VERSION%
)

REM 3. Créer l'environnement virtuel s'il n'existe pas
if not exist "%USERPROFILE%\.pyenv\pyenv-win\versions\%VENV_NAME%" (
    echo "Création de l'environnement virtuel '%VENV_NAME%'..."
    pyenv virtualenv %PYTHON_VERSION% %VENV_NAME%
)

REM 4. Activer l'environnement virtuel
pyenv local %VENV_NAME%
echo "Environnement virtuel '%VENV_NAME%' activé."

REM 5. Installer/vérifier les dépendances
echo "Vérification et installation des dépendances depuis requirements.txt..."
pip install -r requirements.txt > nul

echo "Dépendances à jour."

REM --- Lancement de l'application ---
echo "Lancement de l'application BlueNotebook..."

REM Transmet tous les arguments (%*) au script python
python main.py %*

endlocal
```
