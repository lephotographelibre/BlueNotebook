### Description Technique de la Gestion des Tags dans BlueNotebook

Le système de tags est une fonctionnalité centrale de BlueNotebook, conçue pour organiser et retrouver facilement l'information à travers l'ensemble de votre journal. Il repose sur trois piliers : une syntaxe simple, une coloration syntaxique pour une identification visuelle immédiate, et un puissant système d'indexation asynchrone.

#### 1. Création et Syntaxe des Tags

La création d'un tag est volontairement simple et intuitive pour ne pas interrompre le flux d'écriture.

*   **Syntaxe** : Pour créer un tag, il suffit de préfixer un mot avec un double arobase `@@`, sans espace. Le mot peut contenir des lettres, des chiffres et le tiret bas (`_`).
*   **Exemples** :
    *   `@@projet-alpha`
    *   `@@idee`
    *   `@@reunion_importante`
    *   `@@a_lire`

Cette syntaxe a été choisie pour éviter les conflits avec le Markdown standard et les usages courants du simple arobase (`@`) ou du dièse (`#`).

#### 2. Coloration Syntaxique

Pour qu'un tag soit immédiatement identifiable, il est mis en évidence à la fois dans l'éditeur et dans l'aperçu HTML.

*   **Dans l'Éditeur** : La classe `MarkdownHighlighter` (dans `gui/editor.py`) utilise une expression régulière (`r"@@(\w{2,})\b"`) pour détecter les tags en temps réel. Chaque tag identifié est instantanément coloré en rouge, le rendant visible au milieu du texte.
*   **Dans l'Aperçu HTML** : Pour une expérience cohérente, les tags sont également stylisés dans l'aperçu. Cela est réalisé via une extension Markdown personnalisée qui transforme la syntaxe `@@tag` en une balise HTML, par exemple `<span class="tag">tag</span>`. Une règle CSS est ensuite appliquée à cette classe pour la colorer en rouge, assurant une correspondance visuelle parfaite avec l'éditeur.

#### 3. Le Processus d'Indexation Asynchrone

C'est le cœur du système. Pour permettre une recherche rapide sur l'ensemble du journal, une indexation de tous les tags est réalisée en arrière-plan au démarrage de l'application.

*   **Déclenchement** : L'indexation est lancée automatiquement au démarrage de BlueNotebook et chaque fois que le répertoire du journal est modifié.
*   **Asynchronisme** : Le processus s'exécute dans un thread séparé (`QThreadPool`), grâce à la classe `TagIndexer` qui hérite de `QRunnable`. Cela garantit que l'interface utilisateur reste fluide et réactive, même si l'indexation d'un grand nombre de notes prend du temps.
*   **Processus d'Indexation** :
    1.  Le `TagIndexer` scanne tous les fichiers `.md` présents dans le répertoire du journal.
    2.  Pour chaque fichier, il lit le contenu ligne par ligne.
    3.  Il utilise une expression régulière pour trouver toutes les occurrences de tags (`@@...`).
    4.  Pour chaque tag trouvé, il extrait le tag lui-même, le nom du fichier, et un "contexte" (les 40 caractères qui suivent le tag) pour donner un aperçu de son utilisation.
    5.  Toutes ces informations sont collectées et agrégées.

*   **Notification** : Une fois l'indexation terminée, un signal est émis. L'interface principale le reçoit et met à jour la barre de statut avec un message de confirmation, comme : `✅ Index Tags Terminé: 7 tags uniques trouvés.`.

#### 4. Formats des Fichiers d'Index

À la fin du processus, le `TagIndexer` génère trois fichiers d'index dans le répertoire du journal. Ces fichiers servent de cache pour les futures fonctionnalités de recherche et d'analyse.

1.  **`index_tags.txt` (Format Texte brut)**
    Ce fichier est une liste simple de toutes les occurrences de tags, facile à lire ou à parser avec des scripts simples.
    *   **Format** : `@@tag++contexte du tag++nom_du_fichier.md`
    *   **Exemple** :
        ```
        @@projet++avancement sur le projet BlueNotebook++20240927.md
        @@idee++une nouvelle fonctionnalité pour l'app++20240927.md
        @@projet++réunion de suivi pour le projet Alpha++20240928.md
        ```

2.  **`index_tags.csv` (Format CSV)**
    Ce format est idéal pour une importation dans des tableurs ou des bases de données.
    *   **Structure** : `tag,context,filename,date`
    *   **Exemple** :
        ```csv
        tag,context,filename,date
        @@projet,"avancement sur le projet BlueNotebook",20240927.md,2024-09-27
        @@idee,"une nouvelle fonctionnalité pour l'app",20240927.md,2024-09-27
        @@projet,"réunion de suivi pour le projet Alpha",20240928.md,2024-09-28
        ```

3.  **`index_tags.json` (Format JSON)**
    Ce format structuré est le plus puissant. Il regroupe les informations par tag, ce qui est parfait pour alimenter une interface de recherche avancée.
    *   **Structure** : Un dictionnaire où chaque clé est un tag. La valeur associée contient le nombre d'occurrences et une liste de détails pour chaque occurrence.
    *   **Exemple** :
        ```json
        {
          "@@projet": {
            "occurrences": 2,
            "details": [
              {
                "context": "avancement sur le projet BlueNotebook",
                "filename": "20240927.md",
                "date": "2024-09-27"
              },
              {
                "context": "réunion de suivi pour le projet Alpha",
                "filename": "20240928.md",
                "date": "2024-09-28"
              }
            ]
          },
          "@@idee": {
            "occurrences": 1,
            "details": [
              {
                "context": "une nouvelle fonctionnalité pour l'app",
                "filename": "20240927.md",
                "date": "2024-09-27"
              }
            ]
          }
        }
        ```

#### 5. Utilité et Évolutions Possibles

Ce système de tagging et d'indexation ouvre la porte à de nombreuses fonctionnalités puissantes :

*   **Recherche par Tag** : Créer une interface de recherche où l'utilisateur peut cliquer sur un tag pour voir instantanément toutes les notes et les contextes où il apparaît.
*   **Nuage de Tags (Tag Cloud)** : Visualiser les tags les plus utilisés dans le journal, avec une taille de police proportionnelle à leur fréquence.
*   **Navigation Thématique** : Permettre de filtrer le journal pour n'afficher que les entrées relatives à un `@@projet` spécifique.
*   **Rapports et Analyses** : Utiliser les fichiers `CSV` ou `JSON` pour générer des statistiques sur les thèmes abordés au fil du temps.
*   **Complétion Automatique** : Proposer une complétion automatique des tags existants lors de la saisie de `@@...` dans l'éditeur.

En résumé, le système de tags transforme une collection de notes individuelles en une véritable base de connaissances personnelle, structurée et facilement explorable.