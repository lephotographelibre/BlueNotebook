Bonjour ! La restauration d'une archive de journal est une opération conçue pour être à la fois simple pour l'utilisateur et sécurisée pour vos données. En analysant le code que vous m'avez fourni, notamment la fonction `restore_journal` dans le fichier `bluenotebook/gui/backup_handler.py`, je peux vous détailler son fonctionnement étape par étape.

L'objectif principal est de remplacer le contenu de votre journal actuel par celui d'une sauvegarde (une archive `.zip`), tout en garantissant que votre journal actuel n'est pas perdu en cas de problème.

Voici les différentes étapes du processus :

### 1. Vérification Préalable
Avant toute chose, le programme vérifie si un répertoire de journal est actuellement défini et actif.
*   **Code :** `if not main_window.journal_directory:`
*   **Action :** Si aucun journal n'est ouvert, une boîte de dialogue d'avertissement apparaît pour vous informer que la restauration est impossible, et le processus s'arrête.

### 2. Sélection de l'Archive de Sauvegarde
Le programme vous demande de choisir le fichier de sauvegarde que vous souhaitez restaurer.
*   **Code :** `zip_path, _ = QFileDialog.getOpenFileName(...)`
*   **Action :** Une fenêtre standard de sélection de fichier s'ouvre, filtrant les fichiers pour n'afficher que les archives ZIP (`*.zip`).
*   Si vous annulez cette sélection, le processus s'arrête.

### 3. Création d'une Sauvegarde de Sécurité du Journal Actuel
C'est l'étape la plus importante pour la sécurité de vos données. Avant de toucher à votre journal actuel, le programme prépare un nom unique pour le sauvegarder.
*   **Code :** `current_journal_backup_path = f"{main_window.journal_directory}.bak-{datetime.now().strftime('%Y%m%d-%H%M%S')}"`
*   **Action :** Un nouveau nom est généré en ajoutant `.bak-` suivi de la date et de l'heure actuelles au nom de votre répertoire de journal. Par exemple, si votre journal est dans `MonJournal`, la sauvegarde pourrait s'appeler `MonJournal.bak-20251028-153000`. Cela garantit que chaque sauvegarde de sécurité est unique et ne sera pas écrasée.

### 4. Confirmation de l'Utilisateur
Une boîte de dialogue de confirmation apparaît pour s'assurer que vous comprenez bien les conséquences de l'opération.
*   **Code :** `msg_box = QMessageBox(main_window)`
*   **Action :** Cette fenêtre est très informative. Elle vous indique :
    1.  Que vous êtes sur le point de restaurer depuis une archive.
    2.  Le nom exact du dossier de sauvegarde qui sera créé pour votre journal actuel (celui généré à l'étape 3).
    3.  Que l'application devra redémarrer après l'opération.
*   Vous avez le choix entre "Valider" et "Annuler". Si vous annulez, rien ne se passe.

### 5. Processus de Restauration
Si vous validez, les opérations suivantes sont exécutées dans un bloc `try...except` pour gérer les erreurs éventuelles :
1.  **Renommage du journal actuel :**
    *   **Code :** `os.rename(main_window.journal_directory, current_journal_backup_path)`
    *   **Action :** Votre répertoire de journal actuel est renommé avec le nom de la sauvegarde de sécurité. Vos données sont maintenant en sécurité.
2.  **Création d'un nouveau répertoire vide :**
    *   **Code :** `os.makedirs(main_window.journal_directory)`
    *   **Action :** Un nouveau dossier, vide, est créé avec le nom original de votre journal. C'est dans ce dossier que la restauration aura lieu.
3.  **Extraction de l'archive :**
    *   **Code :** `with zipfile.ZipFile(zip_path, "r") as zip_ref: zip_ref.extractall(main_window.journal_directory)`
    *   **Action :** Le contenu de l'archive `.zip` que vous avez sélectionnée est extrait dans le nouveau répertoire vide.

### 6. Notification et Fermeture
Une fois l'extraction terminée avec succès :
*   **Code :** `QMessageBox.information(...)`
*   **Action :** Une dernière boîte de dialogue vous informe que la restauration est terminée.
*   **Code :** `main_window.close()`
*   **Action :** L'application se ferme. Ce redémarrage est nécessaire pour que BlueNotebook puisse charger correctement le contenu du journal qui vient d'être restauré.

### 7. Gestion des Erreurs
Si un problème survient pendant l'une des étapes de la restauration (renommage, création de dossier, extraction), le bloc `except` se déclenche.
*   **Code :** `except Exception as e:`
*   **Action :** Une boîte de dialogue d'erreur critique s'affiche avec le message d'erreur, vous informant que la restauration a échoué. Dans ce cas, votre journal original (renommé avec `.bak-`) est toujours intact et vous pouvez le restaurer manuellement.
